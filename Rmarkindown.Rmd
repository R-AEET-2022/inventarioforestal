---
title: "Mi primer RMarkDown"
author: "Maria"
date: "2022-09-21"
output:
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(ggplot2)
library(easystats)

datos <- read_csv2("datos/resultados_forcipula.csv")

arbolesmodelo <-  subset (datos, tipo == "Modelo 1" | tipo == "Modelo 2") %>%
   select (parcela, especie_nombre_ifn, Dmm = d1, h)

arbolesdominantes <- subset (datos, tipo == "Dominante") %>%
  select (parcela, Ho = h)

arbolesmodelo_conHo <- arbolesmodelo %>%
  left_join (x = arbolesmodelo, y = arbolesdominantes, by = "parcela")

```

![Así hemos trabajado](images/Diegoenelmuseo.jpg){width="222"}

## Datos de partida

Hemos partido de los datos de un inventario en el que hemos trabajado. Son datos tomados en campo en parcelas de inventario. De cada árbol se coge el diámetro, y de algunos de ellos (árboles modelo), se coge también la altura.

Queremos conseguir un modelo para estimar la altura de los pies normales de los que solo tenemos el diámetro. También tenemos la altura dominante de la parcela (Ho)

Los datos de los pies modelo tienen una estructura como esta:

```{r arbolesmodelo, echo=FALSE}

ggplot(arbolesmodelo_conHo, aes(x = Dmm,     # con geom añade los puntos
                    y = h)) +
      geom_point(color = "orange") +
      labs(x = "Diámetro de los pies (cm)",
       y = "Altura (dm)",
       title = "Datos de los pies modelo",
       caption = "mira que chulo ha quedao")

```


## Generamos un modelo lineal:

Vamos a empezar ajustando un modelo lineal para estimar la altura a partir del diámetro:

```{r modelolineal, echo=TRUE}

modelolineal <- lm(h ~ Dmm, data = arbolesmodelo_conHo)
summary (modelolineal)

```


Como se puede ver en el summary, BLABLABLABLA que si el ajuste que si las estrellitas que si es muy mejorable

El ajuste de este modelo se vería así:

```{r modelolineal_plot, echo=FALSE}

check_model(modelolineal)

```

Y el histograma de los residuos es el siguiente:


```{r modelolineal_hist, echo=FALSE}

hist(residuals(modelolineal))

```


De los resultados concluimos que BLABLABLA


## Ahora probamos con un GLM (Modelo Lineal Generalizado):


Ajustamos el modelo:


```{r GLM, echo=TRUE}

glm <- glm(h ~ Dmm, data = arbolesmodelo_conHo)
summary (glm)

```



Como se puede ver en el summary, BLABLABLABLA que si el ajuste que si las estrellitas que si es muy mejorable

El ajuste de este modelo se vería así:


```{r glm_plot, echo=FALSE}

check_model(glm)

```

Con este modelo lineal, el histograma de los residuos es el siguiente:

```{r glm_hist, echo=FALSE}

hist(residuals(glm))

```


## Probamos con un modelo que teníamos de agresta:

Por útimo, vamos a probar un modelo QUE NOSABEMOS QUE COÑO ES

Vamos a empezar ajustando un modelo lineal para estimar la altura a partir del diámetro:


```{r modeloagresta, echo=TRUE}

# Hs2 <-nls(H ~ 1.3+(a+b*Ho)*exp(d/D),data=data,start=list(a=5,b=0.95,d=-10.7))
# summary(Hs2)
# plot(residuals(Hs2))

```

En este caso, BLIBLIBLIBLI Como se puede ver en el summary, BLABLABLABLA que si el ajuste que si las estrellitas que si es muy mejorable

El ajuste de este modelo se vería así:


```{r modeloagresta_plot, echo=FALSE}

check_model(glm)

```

Con este modelo lineal, el histograma de los residuos es el siguiente:

```{r modeloagresta_hist, echo=FALSE}

hist(residuals(glm))

```

## Comparación de modelos

Por último vamos a hacer una comparación entre los tres modelos:


```{r comparacion, echo=FALSE}


library(performance)
#compare_performance(modelolineal, glm, modeloagresta)



```

El modelo blabla ajusta mas palla o mas pacá

## Conclusiones

Nos quedaríamos con este, porque nos va a estimar mejor la altura de los árboles normales, de los que sólo se ha tomado en campo su diámetro.

FIN








